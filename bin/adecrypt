#! /bin/bash

set -e

file=$1

[[ ! -z  $file ]] && (>&2 echo 'Argument is missing') ; exit 1

if ! [[ $file = *[!\ ]* ]]; then
    (>&2 echo "Invalid argument: $file") ; exit 1
fi

if ! [ -f "./${file}.asc" ]; then
    (>&2 echo "Nothing to encrypt. File ${file}.asc not found!")
    exit 1
fi

if [ -f "./$file" ]; then
    mv -i "./$file" "./$file.$(date +%Y%m%dT%H%M%S%Z)"
fi

gpg --decrypt --output - "./${file}.asc" > "./$file"
